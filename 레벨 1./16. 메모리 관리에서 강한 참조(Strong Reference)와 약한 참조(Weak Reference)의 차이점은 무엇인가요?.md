#  16. ë©”ëª¨ë¦¬ ê´€ë¦¬ì—ì„œ ê°•í•œ ì°¸ì¡°(Strong Reference)ì™€ ì•½í•œ ì°¸ì¡°(Weak Reference)ì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ê°€ìš”?


## ğŸ§  1ï¸âƒ£ ë©”ëª¨ë¦¬ ê´€ë¦¬ì˜ ê¸°ë³¸: ARC (Automatic Reference Counting)

iOSëŠ” **ARC**ë¡œ ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•¨
ğŸ‘‰ â€œê°ì²´ë¥¼ ëˆ„ê°€ ì°¸ì¡°í•˜ê³  ìˆë‚˜?â€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ìœ¼ë¡œ ë©”ëª¨ë¦¬ í•´ì œí•¨

ì¦‰,

> â€œì–´ë–¤ ê°ì²´ë¥¼ ì•„ë¬´ë„ ì•ˆ ì“°ë©´ ARCê°€ ë©”ëª¨ë¦¬ì—ì„œ ë‚ ë¦¼â€

---

## ğŸª¢ 2ï¸âƒ£ ê°•í•œ ì°¸ì¡° (Strong Reference)

* **ê¸°ë³¸ ìƒíƒœ** (ë³„ë„ ì§€ì • ì•ˆ í•˜ë©´ strongì„)
* ì–´ë–¤ ê°ì²´ë¥¼ ë³€ìˆ˜/ìƒìˆ˜ê°€ **ê°•í•˜ê²Œ ì¡ê³  ìˆìœ¼ë©´**
  ARCëŠ” â€œì•„ì§ ì´ ê°ì²´ ì“°ê³  ìˆë„¤â€ë¼ê³  íŒë‹¨í•¨ â†’ âŒ í•´ì œ ì•ˆ í•¨

```swift
class Person {
    var name: String
    init(name: String) { self.name = name }
}

var person1: Person? = Person(name: "ìƒì§€")
var person2 = person1 // person2ë„ ê°™ì€ ê°ì²´ë¥¼ strongìœ¼ë¡œ ì°¸ì¡°
person1 = nil // ì—¬ì „íˆ person2ê°€ ì¡ê³  ìˆìœ¼ë¯€ë¡œ ë©”ëª¨ë¦¬ ì•ˆ ì§€ì›Œì§
```

ğŸ’¡ **ë¹„ìœ **
ğŸ‘‰ ê°•í•œ ì°¸ì¡°ëŠ” â€˜ì†ìœ¼ë¡œ ê½‰ ì¥” ìƒíƒœâ€™
ì†ì„ ë†“ê¸° ì „ê¹Œì§€ëŠ” ì ˆëŒ€ ì‚¬ë¼ì§€ì§€ ì•ŠìŒ

---

## ğŸƒ 3ï¸âƒ£ ì•½í•œ ì°¸ì¡° (Weak Reference)

* ê°ì²´ë¥¼ â€œì•½í•˜ê²Œâ€ ì¡ìŒ â†’ ARCê°€ **ì´ ê°ì²´ ì—†ì• ë„ ê´œì°®ìŒ**
* ê°ì²´ê°€ ì‚¬ë¼ì§€ë©´ `nil`ì´ ìë™ìœ¼ë¡œ ë¨ (ê·¸ë˜ì„œ í•­ìƒ `Optional`)

```swift
class Person {
    var name: String
    init(name: String) { self.name = name }
}

class Apartment {
    weak var owner: Person? // ğŸ‘ˆ ì•½í•œ ì°¸ì¡°
}

var sangji: Person? = Person(name: "ìƒì§€")
var house = Apartment()

house.owner = sangji
sangji = nil // ì´ì œ ì•„ë¬´ë„ Personì„ ê°•í•˜ê²Œ ì•ˆ ì¡ê³  ìˆìŒ â†’ ARCê°€ í•´ì œí•¨
print(house.owner) // nil
```

ğŸ’¡ **ë¹„ìœ **
ğŸ‘‰ weakì€ â€˜ì†ê°€ë½ìœ¼ë¡œ ì‚´ì§ ì–¹ì€ ìƒíƒœâ€™
ëˆ„ê°€ ì¹˜ìš°ë©´ ê·¸ëƒ¥ ë–¨ì–´ì§ (nil ë¨)

---

## ğŸ”„ 4ï¸âƒ£ ìˆœí™˜ ì°¸ì¡° (Retain Cycle)

* Aê°€ Bë¥¼ ê°•í•˜ê²Œ ì¡ê³ 
* Bë„ Aë¥¼ ê°•í•˜ê²Œ ì¡ëŠ” ìƒí™©
  â†’ ì„œë¡œ â€œë†“ì§ˆ ì•Šì•„ì„œâ€ ARCê°€ ì•„ë¬´ë„ í•´ì œ ëª»í•¨ âš ï¸

```swift
class Person {
    var apartment: Apartment?
}
class Apartment {
    var tenant: Person?
}

var person: Person? = Person()
var apt: Apartment? = Apartment()

person?.apartment = apt
apt?.tenant = person

person = nil
apt = nil // âŒ ì„œë¡œ strong ì°¸ì¡° ì¤‘ì´ë¼ ë©”ëª¨ë¦¬ ì•ˆ í•´ì œë¨
```

ğŸ’¡ **í•´ê²° ë°©ë²•**
â†’ í•œìª½ì„ **weak** ë˜ëŠ” **unowned**ë¡œ ë°”ê¾¸ë©´ ë¨

```swift
class Apartment {
    weak var tenant: Person? // âœ… ì•½í•œ ì°¸ì¡°ë¡œ ë³€ê²½
}
```

---

## ğŸ§© 5ï¸âƒ£ í´ë¡œì €ì—ì„œì˜ [weak self] vs [unowned self]

í´ë¡œì €ëŠ” **ìê¸° ìì‹ (self)** ì„ ìº¡ì²˜(capture)í•¨
â†’ ì¦‰, í´ë¡œì €ê°€ ì‹¤í–‰ë˜ê¸° ì „ê¹Œì§€ selfë¥¼ ê°•í•˜ê²Œ ì¡ìŒ

ì´ê²Œ ìˆœí™˜ ì°¸ì¡°ì˜ ì£¼ì›ì¸ ì¤‘ í•˜ë‚˜
ê·¸ë˜ì„œ [weak self] ë˜ëŠ” [unowned self]ë¡œ selfë¥¼ ì•½í•˜ê²Œ ì¡ì•„ì¤Œ

---

### ğŸª¶ `[weak self]`

* selfê°€ ì‚¬ë¼ì§ˆ ìˆ˜ë„ ìˆìŒ â†’ **Optionalë¡œ ì²˜ë¦¬ í•„ìš”**
* ARCê°€ selfë¥¼ í•´ì œí•˜ë©´ ìë™ìœ¼ë¡œ nil ë¨

```swift
someClosure { [weak self] in
    guard let self = self else { return }
    self.doSomething()
}
```

âœ… ì•ˆì „í•˜ê³  ì¼ë°˜ì ìœ¼ë¡œ ë§ì´ ì”€
â— selfê°€ ì¤‘ê°„ì— ì‚¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ì  ìœ ì˜

---

### âš¡ï¸ `[unowned self]`

* selfê°€ ì ˆëŒ€ ë¨¼ì € ì‚¬ë¼ì§€ì§€ ì•ŠëŠ”ë‹¤ê³  í™•ì‹ í•  ë•Œ ì‚¬ìš©
* Optional ì•„ë‹˜
* ë§Œì•½ í•´ì œëœ selfì— ì ‘ê·¼í•˜ë©´ **ëŸ°íƒ€ì„ í¬ë˜ì‹œ ë°œìƒ** âš ï¸

```swift
someClosure { [unowned self] in
    self.doSomething()
}
```

ğŸ’¡ ë¹„ìœ 

| íƒ€ì…        | ì„¤ëª…               | ë¹„ìœ                          |
| --------- | ---------------- | -------------------------- |
| `weak`    | selfê°€ ì‚¬ë¼ì§€ë©´ nil ë¨ | â€œì†ê°€ë½ìœ¼ë¡œ ì‚´ì§ ì¡ìŒâ€              |
| `unowned` | selfê°€ ì‚´ì•„ìˆë‹¤ê³  ê°€ì •   | â€œëˆìœ¼ë¡œ ë¬¶ì–´ë†“ìŒ, í•˜ì§€ë§Œ ëŠì–´ì§€ë©´ ë°”ë¡œ í„°ì§â€ |

---

## ğŸ§¾ í•µì‹¬ ìš”ì•½

| ê°œë…             | ì„¤ëª…                         | íŠ¹ì§•                |
| -------------- | -------------------------- | ----------------- |
| Strong         | ê¸°ë³¸ ì°¸ì¡° ë°©ì‹                   | ê°ì²´ ìœ ì§€             |
| Weak           | ARCê°€ ê°ì²´ ì—†ì• ë„ OK             | ìë™ nil (Optional) |
| Unowned        | nil ë¶ˆê°€, selfëŠ” ë°˜ë“œì‹œ ì¡´ì¬í•œë‹¤ê³  ê°€ì • | ì˜ëª» ì“°ë©´ crash       |
| ìˆœí™˜ ì°¸ì¡°          | ì„œë¡œ ê°•í•˜ê²Œ ì¡ì•„ í•´ì œ ì•ˆ ë˜ëŠ” ìƒí™©       | í•œìª½ì„ weak/unownedë¡œ |
| [weak self]    | ì•ˆì „í•˜ê²Œ self ìº¡ì²˜ (nil ì²´í¬ í•„ìš”)   | ê°€ì¥ ìì£¼ ì‚¬ìš©          |
| [unowned self] | í™•ì‹¤íˆ ì‚´ì•„ìˆì„ ë•Œ ì‚¬ìš©              | ë¹ ë¥´ì§€ë§Œ ìœ„í—˜           |

---

ğŸ’¡ **í•œ ì¤„ë¡œ ì™¸ì›Œë‘ê¸°**

> ê°•í•œ ì°¸ì¡°ëŠ” ê°ì²´ë¥¼ ë¶™ì¡ê³ , ì•½í•œ ì°¸ì¡°ëŠ” ë†“ì•„ì¤Œ
> ìˆœí™˜ ì°¸ì¡°ëŠ” ì„œë¡œ ê½‰ ì¡ì„ ë•Œ ìƒê¸°ê³ 
> `[weak self]`ëŠ” ì•ˆì „, `[unowned self]`ëŠ” í™•ì‹ 
