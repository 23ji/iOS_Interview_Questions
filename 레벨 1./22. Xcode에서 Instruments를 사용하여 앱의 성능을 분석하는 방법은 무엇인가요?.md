#  22. Xcode에서 Instruments를 사용하여 앱의 성능을 분석하는 방법은 무엇인가요?

## 한 줄 개념

**앱이 실행되는 동안 CPU, 메모리, 쓰레드, 누수 등을 실시간으로 분석하는 도구**

👉 코드가 아니라 **실행 중인 앱을 검사하는 도구**

위치
Xcode → Product → Profile
또는 ⌘I

---

# Instruments를 쓰는 이유

* 앱이 느린 이유 찾기
* 메모리 계속 증가하는 이유 찾기
* 누수(Retain Cycle) 찾기
* CPU 과사용 원인 분석

👉

> "왜 느리지?"
> "왜 메모리 계속 늘지?"
> → Instruments가 답 알려줌

---

# 1️⃣ Time Profiler (CPU 분석 도구)

## 무엇을 보는 도구인가?

👉 **어떤 코드가 CPU를 많이 쓰는지 확인하는 도구**

앱이 버벅일 때 가장 먼저 확인함

---

## 어떻게 사용하나?

1. Profile 실행
2. Time Profiler 선택
3. 앱 실행 후 느린 동작 직접 해보기
4. 아래 Call Tree 확인

---

## 어떻게 읽어야 하나?

### 중요한 컬럼

* **Self Time** → 해당 함수가 직접 사용한 시간
* **Total Time** → 하위 함수 포함 총 시간

👉 Self Time이 높은 함수가 진짜 문제일 가능성 높음

---

## 성능 이슈 찾는 방법

1. 느린 화면 직접 조작
2. CPU 급증 구간 찾기
3. Call Tree에서 시간 많이 쓰는 함수 찾기
4. 반복 호출 / 무거운 연산 확인

---

## 실전 예시

* tableView에서 이미지 매번 리사이징
* JSON 파싱을 메인 스레드에서 처리
* 반복문 안에서 네트워크 호출

---

# 2️⃣ Allocations Instrument (메모리 사용 분석)

## 무엇을 보는 도구인가?

👉 **어떤 객체가 얼마나 생성되고 살아있는지 확인**

메모리가 계속 늘어날 때 사용

---

## 어떻게 사용하나?

1. Profile → Allocations 선택
2. 앱 실행
3. 특정 화면 반복 진입/종료
4. 메모리 그래프 확인

---

## 무엇을 확인해야 하나?

* 객체 수가 계속 증가하는지
* 화면 나가도 ViewController가 남아있는지
* 특정 클래스 인스턴스가 줄지 않는지

---

## 메모리 누수 의심 신호

* 화면 나갔는데 객체 수 안 줄어듦
* 동일 객체 계속 누적
* 메모리 그래프 우상향만 함

👉 Retain Cycle 가능성 높음

---

# 3️⃣ Leaks Instrument (진짜 누수 탐지)

## 무엇을 보는 도구인가?

👉 **ARC가 해제하지 못한 메모리 찾는 도구**

즉, 진짜 메모리 누수 탐지기

---

## 어떻게 사용하나?

1. Profile → Leaks 선택
2. 앱 실행
3. 문제 화면 반복
4. 빨간색 표시 확인

---

## Leaks가 알려주는 것

* 누수된 객체
* 참조 관계 그래프
* 누수 경로

---

## Leaks vs Allocations 차이

| 도구          | 용도            |
| ----------- | ------------- |
| Allocations | 메모리 사용 추적     |
| Leaks       | 해제 안 된 메모리 탐지 |

👉 Allocations는 “증가 여부 확인”
👉 Leaks는 “진짜 누수 찾기”

---

# 실무 흐름 정리

앱이 느리다 → Time Profiler
메모리 증가한다 → Allocations
누수 의심된다 → Leaks

---

# 평생 기억용 핵심 정리

* Instruments = 실행 중 앱 분석 도구
* Time Profiler = CPU 범인 찾기
* Allocations = 메모리 사용량 분석
* Leaks = 진짜 메모리 누수 탐지
* 화면 여러 번 들어갔다 나와보는 게 핵심

---

# 마지막으로 진짜 중요한 것

성능 문제는
👉 코드 보면서 추측하지 말고
👉 Instruments로 **측정해서 확인**해야 함

측정 없는 최적화는 감임
